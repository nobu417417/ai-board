<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>みんなの掲示板</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        /* 老若男女に優しい清潔感のあるデザイン */
        :root {
            --plus-color: #ff6b81;
            --minus-color: #747d8c;
            --bg-color: #f1f2f6;
        }
        body { font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", sans-serif; background-color: var(--bg-color); display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; color: #2f3542; }
        .container { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); text-align: center; width: 90%; max-width: 400px; }
        h1 { font-size: 1.1rem; margin-bottom: 20px; color: #57606f; }
        
        .score-area { font-size: 3.5rem; font-weight: bold; margin: 15px 0; color: #2f3542; }
        
        .button-group { display: flex; gap: 15px; justify-content: center; }
        button { flex: 1; border: none; padding: 15px; border-radius: 12px; font-size: 1rem; font-weight: bold; cursor: pointer; transition: transform 0.1s, opacity 0.2s; color: white; }
        button:active { transform: scale(0.95); }
        button:disabled { opacity: 0.5; cursor: not-allowed; }

        .btn-plus { background-color: var(--plus-color); box-shadow: 0 4px 0 #e44d61; }
        .btn-minus { background-color: var(--minus-color); box-shadow: 0 4px 0 #57606f; }
    </style>
</head>
<body>

    <div class="container">
        <h1>この話題、どう思う？</h1>
        <div class="score-area" id="voteCountDisplay">0</div>
        
        <div class="button-group">
            <button id="plusBtn" class="btn-plus">＋ プラス</button>
            <button id="minusBtn" class="btn-minus">ー マイナス</button>
        </div>
    </div>

    <script>
        // --- 設定エリア（ここにあなたの情報を入れてください） ---
        const SUPABASE_URL = "https://svoovxefpjcuwjpqryut.supabase.co";
        const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN2b292eGVmcGpjdXdqcHFyeXV0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExNDQ3ODIsImV4cCI6MjA4NjcyMDc4Mn0.P0r32dM5e-_g7Fny1OKKUCPUre_rBOhFyiTLUnvya9I";
        const threadId = "main-thread";
        // ----------------------------------------------------

        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        async function updateDisplay() {
            const { data, error } = await supabaseClient
                .from("votes")
                .select("score")
                .eq("thread_id", threadId)
                .single();
            if (data) document.getElementById("voteCountDisplay").innerText = data.score;
        }

        async function handleVote(change) {
            const plusBtn = document.getElementById("plusBtn");
            const minusBtn = document.getElementById("minusBtn");
            plusBtn.disabled = true;
            minusBtn.disabled = true;

            let { data } = await supabaseClient
                .from("votes")
                .select("*")
                .eq("thread_id", threadId)
                .single();

            if (!data) {
                await supabaseClient.from("votes").insert({ thread_id: threadId, score: change });
            } else {
                await supabaseClient
                    .from("votes")
                    .update({ score: (data.score || 0) + change })
                    .eq("thread_id", threadId);
            }

            await updateDisplay();
            plusBtn.disabled = false;
            minusBtn.disabled = false;
        }

        document.getElementById("plusBtn").addEventListener("click", () => handleVote(1));
        document.getElementById("minusBtn").addEventListener("click", () => handleVote(-1));

        updateDisplay();
    </script>
</body>
</html>
