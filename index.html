<script>
    // ...（URLやKEYの初期化部分はそのまま）...
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    const threadId = "main-thread";

    // 最新の数値を画面に表示する関数
    async function updateDisplay() {
        const { data } = await supabaseClient
            .from("votes")
            .select("count")
            .eq("thread_id", threadId)
            .single();
        if (data) {
            // もし画面に数値を出す場所（例: <span id="num"></span>）があれば、そこに表示
            const display = document.getElementById("voteCountDisplay");
            if (display) display.innerText = data.count;
        }
    }

    document.getElementById("voteBtn").addEventListener("click", async () => {
        const btn = document.getElementById("voteBtn");
        btn.disabled = true; // 連打防止

        // 1. 現在のカウントを取得
        let { data } = await supabaseClient
            .from("votes")
            .select("*")
            .eq("thread_id", threadId)
            .single();

        if (!data) {
            // データがなければ作る
            await supabaseClient.from("votes").insert({ thread_id: threadId, count: 1 });
        } else {
            // データがあれば +1
            const newCount = (data.count || 0) + 1;
            await supabaseClient
                .from("votes")
                .update({ count: newCount })
                .eq("thread_id", threadId);
        }

        alert("投票しました！");
        await updateDisplay(); // 画面の数字を更新
        btn.disabled = false;
    });

    // ページを開いた時にも数字を表示
    updateDisplay();
</script>
